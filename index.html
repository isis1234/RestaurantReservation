<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      /* Global styles */
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }

      /* Container styles */
      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }

      /* Reservation form styles */
      .reservation-form {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .reservation-form label {
        font-weight: bold;
      }

      .reservation-form input,
      .reservation-form select {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      .reservation-form button {
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .hidden {
        display: none;
      }

      /* Responsive styles */
      @media (max-width: 767px) {
        /* Mobile styles */
        .container {
          padding: 10px;
        }

        .reservation-form {
          gap: 8px;
        }

        .reservation-form input,
        .reservation-form select {
          padding: 6px;
        }

        .reservation-form button {
          padding: 8px 16px;
        }
      }
    </style>
  </head>
  <title>Restaurant Reservation</title>
</head>
<body>
  <form id="reservation-form">
    <label for="restaurant_name">Restaurant Name:</label>
    <select id="restaurant_name" name="restaurant_name" required>
      <option value="">Select restaurant</option>
      <option value="挽肉と米">挽肉と米</option>
    </select>
    <br/>
    <br/>

    <label for="reg_people">Number of People:</label>
    <select id="reg_people" name="reg_people" required>
      <option value="">Select number of people</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
    </select>
    <br/>
    <br/>

    <label for="reg_date">Reservation Date:</label>
    <input type="text" id="reg_date" name="reg_date" value="2024-06-30" required>
    <span style="font-size: 12px; color: grey;">只限格式YYYY-MM-DD</span>
    <br/>
    <br/>

    <label for="reg_time">Reservation Time:</label>
    <select id="reg_time" name="reg_time" required>
      <option value="">Select reservation time</option>
      <option value="12pm">12pm (12:00~12:59)</option>
      <option value="1pm">1pm (13:00~13:59)</option>
      <option value="2pm">2pm (14:00~14:59)</option>
      <option value="3pm">3pm (15:00~15:59)</option>
      <option value="4pm">4pm (16:00~16:59)</option>
      <option value="5pm">5pm (17:00~17:59)</option>
      <option value="6pm">6pm (18:00~18:59)</option>
      <option value="7pm">7pm (19:00~19:59)</option>
      <option value="8pm">8pm (20:00~20:59)</option>
      <option value="9pm">9pm (21:00~21:59)</option>
      <option value="10pm">10pm (22:00~22:59)</option>
      <option value="11pm">11pm (23:00~23:59)</option>
    </select>
    <br/>
    <br/>
    <label for="contact_method">Contact Method:</label>
    <select id="contact_method" name="contact_method" required>
      <option value="">Select a contact method</option>
      <option value="telegram">Telegram</option>
      <option value="whatsapp">WhatsApp</option>
    </select>
    <br/>
    <div id="telegram-input" class="hidden">
      <label for="telegram">Telegram:</label>
      <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-login="yuyu_test_bot" data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
      <input type="hidden" id="telegram" name="telegram">
      <br/>
      <script type="text/javascript">
        function onTelegramAuth(user) {
          console.log(user)
          alert('Logged in as ' + user.first_name + ' ' + user.last_name + ' (' + user.id + (user.username ? ', @' + user.username : '') + ')');
          document.getElementById('telegram').value = JSON.stringify(user);
        }
      </script>
    </div>
    <div id="whatsapp-input" class="hidden">
      <label for="whatsapp">WhatsApp:</label>
      <input type="text" id="whatsapp" name="whatsapp">
    </div>

    <br/>
    <br/>
    <button type="button" id="confirm">Confirm Reservation</button>
  </form>

  <hr/>
  <div id="response-message"></div>

  <script>
    // Set the current date in the "reg_date" input field
    const today = new Date().toISOString().slice(0, 10);
    document.getElementById('reg_date').value = today;

    // Handle contact method selection
    const contactMethodSelect = document.getElementById('contact_method');
    const telegramInput = document.getElementById('telegram-input');
    const whatsappInput = document.getElementById('whatsapp-input');
    contactMethodSelect.addEventListener('change', function() {
      if (this.value === 'telegram') {
        telegramInput.classList.remove('hidden');
        whatsappInput.classList.add('hidden');
      } else if (this.value === 'whatsapp') {
        whatsappInput.classList.remove('hidden');
        telegramInput.classList.add('hidden');
      } else {
        telegramInput.classList.add('hidden');
        whatsappInput.classList.add('hidden');
      }
    });

    // Confirm Button
    document.getElementById('confirm').addEventListener('click', function() {
      // Get all required fields
      const requiredFields = document.querySelectorAll('[required]');
      let allFieldsFilled = true;

      // Check if all required fields are filled
      requiredFields.forEach((field) => {
        if (field.value === '') {
          field.classList.add('error');
          allFieldsFilled = false;
        } else {
          field.classList.remove('error');
        }
      });

      // If all required fields are filled, submit the form
      if (allFieldsFilled) {
        // Gather form data
        const formData = new FormData(document.getElementById('reservation-form'));

        // Send POST request to localhost:3000
        fetch('https://ye2tzeu2aa.execute-api.ap-southeast-1.amazonaws.com/default/RestaurantReservation-NewReservation', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: formData
        })
        .then(response => {
          if (response.ok) {
            const responseMessage = document.getElementById('response-message');
            responseMessage.textContent = '到時再叫你, Hide the message after 1 minute';
            responseMessage.classList.add('success-message');
            responseMessage.classList.remove('hidden');

            // Hide the message after 1 minute
            setTimeout(() => {
              responseMessage.classList.add('hidden');
            }, 60000);
          } else {
            alert('Error confirming reservation. Please try again.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('An error occurred. Please try again later.');
        });
      } else {
        alert('Please fill in all required fields.');
      }
    });
  </script>
</body>
</html>